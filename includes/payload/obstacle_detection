<h2 id="obstacle-detection">Obstacle Detection</h2>

<blockquote>
<p>Definition</p>
</blockquote>
<pre class="highlight shell tab-shell"><code><span class="c"># API call described below requires shell access, either login to the device using desktop or use ssh for remote login.</span>

ROS-Topic Name: /&lt;namespace&gt;/dji_msdk/obstacle_distance
ROS-Topic Type: core_api/ObstacleData, below is its description

Response structure:
    std_msgs/Header header
      uint32 seq
      <span class="nb">time </span>stamp
      string frame_id
    float32[] front
    float32[] back
    uint8[] front_warning_level
    uint8[] back_warning_level
    bool on_hold
    bool is_enabled
</code></pre><pre class="highlight cpp tab-cpp"><code><span class="c1">// C++ API described below can be used in onboard scripts only. For remote scripts you can use http client libraries to call FlytOS REST endpoints from C++.
</span>
<span class="c1">// Not Implemented
</span></code></pre><pre class="highlight python tab-python"><code><span class="c"># Python API described below can be used in onboard scripts only. For remote scripts you can use http client libraries to call FlytOS REST endpoints from Python.</span>

<span class="c"># Not Implemented</span>
</code></pre><pre class="highlight cpp tab-cpp--ros"><code><span class="c1">// ROS services and topics are accessible from onboard scripts only.
</span>
<span class="n">ROS</span><span class="o">-</span><span class="n">Topic</span> <span class="n">Name</span><span class="o">:</span> <span class="o">/&lt;</span><span class="k">namespace</span><span class="o">&gt;/</span><span class="n">dji_msdk</span><span class="o">/</span><span class="n">obstacle_distance</span>
<span class="n">ROS</span><span class="o">-</span><span class="n">Topic</span> <span class="n">Type</span><span class="o">:</span> <span class="n">core_api</span><span class="o">/</span><span class="n">ObstacleData</span><span class="p">,</span> <span class="n">below</span> <span class="n">is</span> <span class="n">its</span> <span class="n">description</span>

<span class="n">Response</span> <span class="n">structure</span><span class="o">:</span>
    <span class="n">std_msgs</span><span class="o">/</span><span class="n">Header</span> <span class="n">header</span>
      <span class="n">uint32</span> <span class="n">seq</span>
      <span class="n">time</span> <span class="n">stamp</span>
      <span class="n">string</span> <span class="n">frame_id</span>
    <span class="n">float32</span><span class="p">[]</span> <span class="n">front</span>
    <span class="n">float32</span><span class="p">[]</span> <span class="n">back</span>
    <span class="n">uint8</span><span class="p">[]</span> <span class="n">front_warning_level</span>
    <span class="n">uint8</span><span class="p">[]</span> <span class="n">back_warning_level</span>
    <span class="kt">bool</span> <span class="n">on_hold</span>
    <span class="kt">bool</span> <span class="n">is_enabled</span>
</code></pre><pre class="highlight python tab-python--ros"><code><span class="c"># ROS services and topics are accessible from onboard scripts only.</span>

<span class="n">ROS</span><span class="o">-</span><span class="n">Topic</span> <span class="n">Name</span><span class="p">:</span> <span class="o">/&lt;</span><span class="n">namespace</span><span class="o">&gt;/</span><span class="n">dji_msdk</span><span class="o">/</span><span class="n">obstacle_distance</span>
<span class="n">ROS</span><span class="o">-</span><span class="n">Topic</span> <span class="n">Type</span><span class="p">:</span> <span class="n">core_api</span><span class="o">/</span><span class="n">ObstacleData</span><span class="p">,</span> <span class="n">below</span> <span class="ow">is</span> <span class="n">its</span> <span class="n">description</span>

<span class="n">Response</span> <span class="n">structure</span><span class="p">:</span>
    <span class="n">std_msgs</span><span class="o">/</span><span class="n">Header</span> <span class="n">header</span>
      <span class="n">uint32</span> <span class="n">seq</span>
      <span class="n">time</span> <span class="n">stamp</span>
      <span class="n">string</span> <span class="n">frame_id</span>
    <span class="n">float32</span><span class="p">[]</span> <span class="n">front</span>
    <span class="n">float32</span><span class="p">[]</span> <span class="n">back</span>
    <span class="n">uint8</span><span class="p">[]</span> <span class="n">front_warning_level</span>
    <span class="n">uint8</span><span class="p">[]</span> <span class="n">back_warning_level</span>
    <span class="nb">bool</span> <span class="n">on_hold</span>
    <span class="nb">bool</span> <span class="n">is_enabled</span>
</code></pre><pre class="highlight javascript tab-javascript--REST"><code><span class="nx">This</span> <span class="nx">is</span> <span class="nx">a</span> <span class="nx">REST</span> <span class="nx">call</span> <span class="k">for</span> <span class="nx">the</span> <span class="nx">API</span><span class="p">.</span> <span class="nx">Make</span> <span class="nx">sure</span> <span class="nx">to</span> <span class="nx">replace</span> 
    <span class="nx">ip</span><span class="p">:</span> <span class="nx">ip</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">FlytOS</span> <span class="nx">running</span> <span class="nx">device</span>
    <span class="nl">namespace</span><span class="p">:</span> <span class="nx">namespace</span> <span class="nx">used</span> <span class="nx">by</span> <span class="nx">the</span> <span class="nx">FlytOS</span> <span class="nx">device</span><span class="p">.</span>

<span class="nl">URL</span><span class="p">:</span> <span class="s1">'http://&lt;ip&gt;/ros/&lt;namespace&gt;/dji_msdk/obstacle_distance'</span>

<span class="nx">JSON</span> <span class="nx">Response</span><span class="p">:</span>
<span class="p">{</span>
    <span class="nl">front</span><span class="p">:</span> <span class="nx">FloatArray</span><span class="p">,</span>
    <span class="nx">back</span><span class="p">:</span> <span class="nx">FloatArray</span><span class="p">,</span>
    <span class="nx">front_warning_level</span><span class="p">:</span> <span class="nx">IntArray</span><span class="p">,</span>
    <span class="nx">back_warning_level</span><span class="p">:</span> <span class="nx">IntArray</span><span class="p">,</span>
    <span class="nx">on_hold</span><span class="p">:</span> <span class="nx">Bool</span><span class="p">,</span>
    <span class="nx">is_enabled</span><span class="p">:</span> <span class="nx">Bool</span>
<span class="p">}</span>
</code></pre><pre class="highlight javascript tab-javascript--Websocket"><code><span class="nx">This</span> <span class="nx">is</span> <span class="nx">a</span> <span class="nx">Websocket</span> <span class="nx">call</span> <span class="k">for</span> <span class="nx">the</span> <span class="nx">API</span><span class="p">.</span> <span class="nx">Make</span> <span class="nx">sure</span> <span class="nx">you</span> 
<span class="nx">initialise</span> <span class="nx">the</span> <span class="nx">websocket</span> <span class="nx">using</span> <span class="nx">websocket</span> <span class="nx">initialising</span> 
<span class="nx">API</span> <span class="nx">and</span> <span class="nx">replace</span> <span class="nx">namespace</span> <span class="kd">with</span> <span class="nx">the</span> <span class="nx">namespace</span> <span class="nx">of</span> 
<span class="nx">the</span> <span class="nx">FlytOS</span> <span class="nx">running</span> <span class="nx">device</span> <span class="nx">before</span> <span class="nx">calling</span> <span class="nx">the</span> <span class="nx">API</span> 
<span class="kd">with</span> <span class="nx">websocket</span><span class="p">.</span>

<span class="nl">name</span><span class="p">:</span> <span class="s1">'/&lt;namespace&gt;/dji_msdk/obstacle_distance'</span><span class="p">,</span>
<span class="nx">serviceType</span><span class="p">:</span> <span class="s1">'core_api/ObstacleData'</span>

<span class="nl">Response</span><span class="p">:</span>
<span class="p">{</span>
    <span class="nl">front</span><span class="p">:</span> <span class="nx">FloatArray</span><span class="p">,</span>
    <span class="nx">back</span><span class="p">:</span> <span class="nx">FloatArray</span><span class="p">,</span>
    <span class="nx">front_warning_level</span><span class="p">:</span> <span class="nx">IntArray</span><span class="p">,</span>
    <span class="nx">back_warning_level</span><span class="p">:</span> <span class="nx">IntArray</span><span class="p">,</span>
    <span class="nx">on_hold</span><span class="p">:</span> <span class="nx">Bool</span><span class="p">,</span>
    <span class="nx">is_enabled</span><span class="p">:</span> <span class="nx">Bool</span>
<span class="p">}</span>
</code></pre>
<blockquote>
<p>Example</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>Not Implemented
</code></pre><pre class="highlight cpp tab-cpp"><code><span class="n">Not</span> <span class="n">Implemented</span>
</code></pre><pre class="highlight python tab-python"><code><span class="n">Not</span> <span class="n">Implemented</span>
</code></pre><pre class="highlight cpp tab-cpp--ros"><code><span class="n">Not</span> <span class="n">Implemented</span>
</code></pre><pre class="highlight python tab-python--ros"><code><span class="n">Not</span> <span class="n">Implemented</span>
</code></pre><pre class="highlight javascript tab-javascript--REST"><code><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
    <span class="na">type</span><span class="p">:</span> <span class="s2">"GET"</span><span class="p">,</span>
    <span class="na">dataType</span><span class="p">:</span> <span class="s2">"json"</span><span class="p">,</span>
    <span class="na">url</span><span class="p">:</span> <span class="s2">"http://&lt;ip&gt;/ros/&lt;namespace&gt;/dji_msdk/obstacle_distance"</span><span class="p">,</span>
    <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
           <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre><pre class="highlight javascript tab-javascript--Websocket"><code><span class="kd">var</span> <span class="nx">obsData</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ROSLIB</span><span class="p">.</span><span class="nx">Topic</span><span class="p">({</span>
    <span class="na">ros</span> <span class="p">:</span> <span class="nx">ros</span><span class="p">,</span>
    <span class="na">name</span> <span class="p">:</span> <span class="s1">'/&lt;namespace&gt;/dji_msdk/obstacle_distance'</span><span class="p">,</span>
    <span class="na">messageType</span> <span class="p">:</span> <span class="s1">'core_api/ObstacleData'</span><span class="p">,</span>
    <span class="na">throttle_rate</span><span class="p">:</span> <span class="mi">200</span>
<span class="p">});</span>

<span class="nx">obsData</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
<span class="p">});</span>
</code></pre>
<blockquote>
<p>Example response</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>Not Implemented
</code></pre><pre class="highlight cpp tab-cpp"><code><span class="n">Not</span> <span class="n">Implemented</span>
</code></pre><pre class="highlight python tab-python"><code><span class="n">Not</span> <span class="n">Implemented</span>
</code></pre><pre class="highlight cpp tab-cpp--ros"><code><span class="n">Not</span> <span class="n">Implemented</span>
</code></pre><pre class="highlight python tab-python--ros"><code><span class="n">Not</span> <span class="n">Implemented</span>
</code></pre><pre class="highlight javascript tab-javascript--REST"><code><span class="nx">Not</span> <span class="nx">Implemented</span>
</code></pre><pre class="highlight javascript tab-javascript--Websocket"><code><span class="nx">front</span><span class="p">:</span> <span class="p">[</span><span class="mf">16.43000030517578</span><span class="p">,</span> <span class="mf">14.010000228881836</span><span class="p">,</span> <span class="mf">0.8700000047683716</span><span class="p">,</span> <span class="mf">0.8700000047683716</span><span class="p">]</span>
<span class="nl">back</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.8700000047683716</span><span class="p">,</span> <span class="mf">0.8700000047683716</span><span class="p">,</span> <span class="mf">0.8700000047683716</span><span class="p">,</span> <span class="mf">15.569999694824219</span><span class="p">]</span>
<span class="nl">front_warning_level</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
<span class="nx">back_warning_level</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
<span class="nx">on_hold</span><span class="p">:</span> <span class="nx">False</span>
<span class="nl">is_enabled</span><span class="p">:</span> <span class="nx">False</span>
</code></pre>
<h3 id="description">Description:</h3>

<p>This API publishes detected obstacle data of a supported DJI drone.</p>

<aside class="warning">
    This API will **ONLY** work with FlytOS mobile app.
</aside>

<h3 id="parameters">Parameters:</h3>

<p>Following parameters are applicable for onboard C++ and Python scripts. Scroll down for their counterparts in RESTful, Websocket, ROS. However the description of these parameters applies to all platforms. </p>

<p>Arguments:</p>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>front</td>
<td>floatArray</td>
<td>array of detected obstacle distance (in m) for every quadrant of front sensor from left to right</td>
</tr>
<tr>
<td>back</td>
<td>floatArray</td>
<td>array of detected obstacle distance (in m) for every quadrant of back sensor from left to right</td>
</tr>
<tr>
<td>front_warning_level</td>
<td>intArray</td>
<td>array of warning levels for every quadrant of front sensor from left to right. Values in range (0 - 5) or 15. 0 being farthest and 5 being closest. If the sensor data is invalid, this value will be 15.</td>
</tr>
<tr>
<td>back_warning_level</td>
<td>intArray</td>
<td>array of detected obstacle distance (in m) for every quadrant of back sensor from left to right</td>
</tr>
<tr>
<td>on_hold</td>
<td>bool</td>
<td>stores state if autopilot has engaged obstacle avoidance</td>
</tr>
<tr>
<td>is_enabled</td>
<td>bool</td>
<td>stores state if collision avoidance is enabled or not</td>
</tr>
</tbody></table>

<h3 id="ros-endpoint">ROS endpoint:</h3>

<p>Payload APIs in FlytOS are derived from / wrapped around the core services available in ROS. Onboard service clients in rospy / roscpp can call these APIs. Take a look at roscpp and rospy API definition for message structure. </p>

<ul>
<li>Type: <code class="prettyprint">Ros Service</code></li>
<li>Name: <code class="prettyprint">/&lt;namespace&gt;/dji_msdk/obstacle_distance</code></li>
<li>Service Type: <code class="prettyprint">core_api/ObstacleData</code></li>
</ul>

<h3 id="websocket-endpoint">Websocket endpoint:</h3>

<p>Websocket APIs can be called from javascript using <a href="https://github.com/RobotWebTools/roslibjs">roslibjs library</a>.</p>

<p>Java websocket clients are supported using <a href="http://wiki.ros.org/rosjava">rosjava</a>.</p>

<ul>
<li>name: <code class="prettyprint">/&lt;namespace&gt;/dji_msdk/obstacle_distance</code></li>
<li>serviceType: <code class="prettyprint">core_api/ObstacleData</code></li>
</ul>
